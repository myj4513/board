<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
<h1>게 시 판</h1>

<h4>로그인</h4>

<form method="post" th:object="${loginForm}" onsubmit="return login()">
  <div th:if="${#fields.hasGlobalErrors()}">
    <p class="field-error" th:each="err : ${#fields.globalErrors()}" th:text="${err}"></p>
  </div>

  <table>
    <tr>
      <td> 아이디 </td>
      <td> <input type="text" th:field="*{loginId}" > </td>
      <td> <div th:errors="*{loginId}">aaaa</div></td>
    </tr>
    <tr>
      <td> 비밀번호 </td>
      <td> <input type="password" th:field="*{password}" th:errorclass="field-error"> </td>
      <td> <div class="field-error" th:errors="*{password}">aaaa</div></td>
    </tr>
  </table>
  <span id="error-messages"></span>
  <div>
    <input type="submit" value="로그인">
    <input type="button" value="취소" th:onclick="|location.href='@{/}'|">
  </div>
</form>
</body>
<script>
  function login(){
    const loginId = document.querySelector('#loginId').value;
    const password = document.querySelector('#password').value;
    let form = new FormData();
    form.append('loginId', loginId);
    form.append('password', password);

    var result

    axios.post('/ajax/login',  form, {
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'}})
    .then(response => {
      if(response.data=="WRONG"){
        result = false;
      } else if(response.data=="OK"){
        result = true;
      }
    });
    return result;
    // onsubmit에 대해 boolean을 반환하고자 하였으나, axios내에서 외부 변수를 읽지 못함.
    // axios 내에서 return true/false; 가 적용되지 않음.
  }
</script>
</html>